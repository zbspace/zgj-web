var e=Object.defineProperty,a=(a,l,t)=>(((a,l,t)=>{l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t})(a,"symbol"!=typeof l?l+"":l,t),t);import l from"./index-e01f9df9.js";import{c as t}from"./tree-8921f487.js";import{c as o}from"./documentsDetails-8b022303.js";import{a7 as s,a3 as n,E as i,g as d,ae as r,P as u,a4 as c,m as p}from"./chunk-vform-d740b35c.js";import{a as m}from"./actionMoreDialog-7035c1c1.js";import{r as y,j as f,C as h,F as v,Q as T,N as w,B as b,u as g,c as D,R as _,b as V,a1 as k,G as I,H as j,I as x,J as B,P as C,V as P,W as F}from"./chunk-element-plus-a77de3d2.js";import{J as N}from"./JyTable-d62bb35b.js";/* empty css                                                             */import"./cha-kong-c10eac4e.js";import"./JyTabs-726242c5.js";/* empty css                                                               */import"./table-e0a114b8.js";import"./sangedian-6ea00dcf.js";/* empty css                                                                         */import"./portion-e63dfdb7.js";/* empty css                                                                */import"./yuan-hui-31c99901.js";import"./Layout-e90710df.js";import"./searchForm-96cc0cf8.js";import"./ketanchude-a94e84bc.js";import"./KDocumentTypeDialog-63de8919.js";import"./pagination-3c925a2b.js";import"./batch-6eb7c760.js";import"./index-d761d72f.js";class S{constructor(){a(this,"fileTypeNo",""),a(this,"fileTypeName",""),a(this,"fileTypeSn",""),a(this,"fileTypePid","-1")}}class U{constructor(){a(this,"fileTypeIds",[])}}class J{constructor(){a(this,"fileTypeId",""),a(this,"organs",[]),a(this,"roles",[]),a(this,"users",[])}}class M{constructor(){a(this,"fileTypeId",""),a(this,"applicantPreview",""),a(this,"applicantDownload","")}}const A=_("提交"),E=_("取消"),O={name:"AddFileType"},R=Object.assign(O,{props:{modelValue:{type:Boolean,default:!1},optionsTree:{type:Array,default:()=>[]},curFromData:{type:Object,default:()=>{}},fileTypePid:{type:String,default:"-1"}},emits:["update:modelValue","refresh","on-closed"],setup(e,{emit:a}){const l=e,t=y(new S),o=y(null),d={fileTypeName:[{required:!0,message:"请输入",trigger:"blur"}]},r=f({get:()=>l.modelValue,set(e){a("update:modelValue",e)}}),u=async()=>{try{await o.value.validate(),t.value.fileTypePid||(t.value.fileTypePid="0"),t.value.fileTypeId?(await s.fileTypeEdit(t.value),n("文件类型修改成功")):(await s.fileTypeAdd(t.value),n("文件类型添加成功")),r.value=!1,t.value=new S,a("refresh")}catch(e){i(e)}},c=async()=>{try{if(l.curFromData.fileTypeId){const e=await await s.getFileTypeInfo(l.curFromData.fileTypeId);t.value={...t.value,...e.data}}else t.value.fileTypePid=l.fileTypePid,(async()=>{try{const e=await s.generateBizNo();t.value.fileTypeNo=e.data||""}catch(e){i(e)}})()}catch(e){i(e)}},p=()=>{r.value=!1},m=()=>{t.value=new S,a("on-closed")};return(a,s)=>{const n=h("el-input"),i=h("el-form-item"),y=h("el-tree-select"),f=h("el-form"),_=h("el-button"),V=h("JyDialog2");return v(),T(V,{title:e.curFromData.fileTypeId?"修改文件类型":"新增文件类型",modelValue:g(r),"onUpdate:modelValue":s[4]||(s[4]=e=>D(r)?r.value=e:null),onOnOpened:c,onOnClosed:m,height:220},{footer:w((()=>[b(_,{type:"primary",onClick:u},{default:w((()=>[A])),_:1}),b(_,{onClick:p},{default:w((()=>[E])),_:1})])),default:w((()=>[b(f,{ref_key:"formRef",ref:o,model:t.value,rules:d,"label-width":"120px",class:"demo-ruleForm"},{default:w((()=>[b(i,{label:"文件类型编码"},{default:w((()=>[b(n,{modelValue:t.value.fileTypeNo,"onUpdate:modelValue":s[0]||(s[0]=e=>t.value.fileTypeNo=e),disabled:""},null,8,["modelValue"])])),_:1}),b(i,{label:"文件类型名称",prop:"fileTypeName"},{default:w((()=>[b(n,{modelValue:t.value.fileTypeName,"onUpdate:modelValue":s[1]||(s[1]=e=>t.value.fileTypeName=e),clearable:"",maxlength:"128"},null,8,["modelValue"])])),_:1}),b(i,{label:"文件类型字号"},{default:w((()=>[b(n,{modelValue:t.value.fileTypeSn,"onUpdate:modelValue":s[2]||(s[2]=e=>t.value.fileTypeSn=e),clearable:"",maxlength:"128"},null,8,["modelValue"])])),_:1}),b(i,{label:"上级文件夹"},{default:w((()=>[b(y,{modelValue:t.value.fileTypePid,"onUpdate:modelValue":s[3]||(s[3]=e=>t.value.fileTypePid=e),data:l.optionsTree,"check-strictly":"",style:{width:"100%"},props:{children:"child",label:"fileTypeName",disabled:e=>(e.fileTypeId===l.curFromData.fileTypeId||e.fileTypePid===l.curFromData.fileTypeId)&&"-1"!==e.fileTypeId},"value-key":"fileTypeId"},null,8,["modelValue","data","props"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","modelValue"])}}}),q=_("提交"),Y=_("取消"),L={name:"PrivacySet"},z=Object.assign(L,{props:{modelValue:{type:Boolean,default:!1},optionsTree:{type:Array,default:()=>[]},fileTypeId:{type:String,default:""}},emits:["update:modelValue","refresh","on-closed"],setup(e,{emit:a}){const l=e,t=y(new M),o=y(null),d={fileTypeName:[{required:!0,message:"请输入",trigger:"blur"}]},r=f({get:()=>l.modelValue,set(e){a("update:modelValue",e)}}),u=async()=>{try{await s.privacySet(t.value),r.value=!1,t.value=new M,n("特殊类型隐私设置成功"),a("refresh")}catch(e){i(e)}},c=()=>{t.value.fileTypeId=l.fileTypeId,(async()=>{try{const e=await s.queryPrivacyByType(l.fileTypeId);t.value={...t.value,...e.data}}catch(e){i(e)}})()},p=()=>{r.value=!1},m=()=>{t.value=new M,a("on-closed")};return(e,a)=>{const l=h("el-switch"),s=h("el-form-item"),n=h("el-form"),i=h("el-button"),y=h("JyDialog2");return v(),T(y,{title:"特殊类型隐私配置",modelValue:g(r),"onUpdate:modelValue":a[2]||(a[2]=e=>D(r)?r.value=e:null),onOnOpened:c,onOnClosed:m,width:500,appendToBody:"",class:"privacy-set-form"},{footer:w((()=>[b(i,{type:"primary",onClick:u},{default:w((()=>[q])),_:1}),b(i,{onClick:p},{default:w((()=>[Y])),_:1})])),default:w((()=>[b(n,{ref_key:"formRef",ref:o,model:t.value,rules:d},{default:w((()=>[b(s,{label:"用印单据上传附件仅申请人能预览",prop:"applicantPreview"},{default:w((()=>[b(l,{modelValue:t.value.applicantPreview,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value.applicantPreview=e),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])])),_:1}),b(s,{label:"用印单据上传附件仅申请人能预览",prop:"applicantDownload"},{default:w((()=>[b(l,{modelValue:t.value.applicantDownload,"onUpdate:modelValue":a[1]||(a[1]=e=>t.value.applicantDownload=e),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])}}}),H=e=>(P("data-v-9eb8dd83"),e=e(),F(),e),K={class:"fileManagement-documentType"},G={class:"title"},W=H((()=>j("div",null,"文件类型",-1))),$={class:"title-more"},Q={class:"title-more-add"},Z=H((()=>j("div",{class:"title-more-down"},null,-1))),X={class:"components-tree"},ee={class:"ap-box"},ae={name:"DocumentType"},le=d(Object.assign(ae,{setup(e){const a=y(!1),i=y(!1),d=y(new U),f=y(new r),D=y(!1),P=y(!1),F=y({}),S=y(""),M=y([]),A=y(new J),E=y([]),O=y(!1),q=y(null),Y=y(null),L=y(null),H=y([]),ae=V({componentsSearchForm:{style:{lineStyle:{width:"calc(100% / 3)"},labelStyle:{width:"100px"}},data:[{id:"keyword",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"请输入文件类型名称或编码"}},{id:"beginTime",label:"创建时间",type:"picker",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD","disabled-date":e=>e.getTime()>Date.now(),"default-value":[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},style:{},requestType:"array"}],butData:[{id:"more",name:"展开",type:"unfold",defaultAttribute:{type:"primary"},style:{}},{id:"inquire",name:"查询",type:"click",defaultAttribute:{type:"primary"},style:{}},{id:"reset",name:"重置",type:"click",defaultAttribute:{},style:{}}]},componentsTable:{header:[{prop:"fileTypeNo",label:"文件类型编码",sortable:!0,show:!0,"min-width":150},{prop:"fileTypeName",label:"文件类型名称",sortable:!0,show:!0,"min-width":150},{prop:"level",label:"文件类型层级",sortable:!0,show:!0,"min-width":150},{prop:"fileSum",label:"文件数",sortable:!0,show:!0,"min-width":150},{prop:"createUser",label:"创建人",sortable:!0,show:!0,"min-width":150},{prop:"createDatetime",label:"创建时间",show:!0,sortable:!0,"min-width":180},{prop:"caozuo",label:"操作",fixed:"right",show:!0,width:350,rankDisplayData:[{name:"修改",code:1},{name:"删除",code:2},{name:"设置可见范围",code:3},{name:"特殊类型隐私配置",code:4}]}]},componentsTree:{data:[],defaultAttribute:{"check-on-click-node":!0,"show-checkbox":!1,"default-expand-all":!0,"expand-on-click-node":!1,"check-strictly":!0,"highlight-current":!0,"node-key":"fileTypeId","current-node-key":"-1"},defaultProps:{label:"fileTypeName",children:"child",isLeaf:"haveChildren",nodeKey:"fileTypeId"},value:""},componentsDocumentsDetails:{show:!1,visible:[{label:"文件详情",name:"Details-of-Document"},{label:"操作记录",name:"operating-record"}]},componentsBatch:{selectionData:[],defaultAttribute:{disabled:!0},data:[{name:"批量删除",code:1}]},JyElMessageBox:{show:!1,header:{data:""},content:{data:""}},showToastDialog:{show:!1,header:{data:"",icon:"/src/assets/svg/common/warning.svg"},content:{data:""}},showDeleteFTyle:{show:!1,header:{data:"",icon:"/src/assets/svg/common/warning.svg"},content:{data:""}}}),le=(e,a,l,t)=>{d.value.fileTypeIds=c([e],"child","fileTypeId"),q.value.reloadData()},te=()=>{(async()=>{try{P.value=!0;const e=await s.getFileTypeListPage({...d.value,...f});ae.componentsTable.data=e.data.records||[],f.value.total=e.data&&e.data.total,f.value.pages=e.data&&e.data.pages}catch(e){}P.value=!1})(),(async()=>{try{const e=await s.getTreeList({});ae.componentsTree.data=[],ae.componentsTree.data.push({fileTypeName:"文件类型",fileTypeId:"-1",child:e.data||[]}),ae.componentsTree.value="-1",q.value.reloadData()}catch(e){}})(),F.value={}},oe=async()=>{var e;try{E.value.length?(await s.batchDelete({fileTypeIds:E.value}),n("批量删除成功"),ae.showToastDialog.show=!1):(await s.fileTypeDelete(S.value),n("成功删除文件类型"),ae.JyElMessageBox.show=!1),te()}catch(a){if(a.code&&500===a.code&&(null==(e=a.data)?void 0:e.length)){ae.showToastDialog.show=!1,ae.JyElMessageBox.show=!1,ae.componentsBatch.selectionData=[],ae.showDeleteFTyle.show=!0;const e=H.value.filter((e=>a.data.includes(e.fileTypeId)));L.value={header:"删除失败",content:"以下文件类型已被使用，不允许删除，若文件类型被已启用的文件类型关联或者已发起用印申请，则认为被使用。",selectionData:e}}}},se=async e=>{try{const l=await s.queryVisibleRByFileType(e),t=l.data.roles?l.data.roles:[],o=l.data.organs?l.data.organs:[],n=l.data.users?l.data.users:[];M.value=[...o,...t,...n],i.value=!0,setTimeout((()=>{a.value=!0}),50)}catch(l){}},ne=()=>{a.value=!1,setTimeout((()=>{i.value=!1}),300)},ie=async e=>{e.forEach((a=>{"user"===a.type&&(A.value.users=e.filter((e=>"user"===e.type))),"organ"===a.type&&(A.value.organs=e.filter((e=>"organ"===e.type))),"role"===a.type&&(A.value.roles=e.filter((e=>"role"===e.type)))}));try{await s.viewRangSet(A.value);a.value=!1,n("可见范围设置成功")}catch(l){}},de=()=>{F.value={}},re=async(e,a)=>{const l=q.value.getSelectionRows();E.value=l.map((e=>e.fileTypeId)),1===e.code&&(ae.componentsBatch.selectionData=a,Y.value={header:{data:"批量删除"},content:{data:"是否删除以下文件类型？"}},ae.showToastDialog.show=!0),2===e.code&&p("待产品确认回显功能")};function ue(e,a,l,t){"1"===a.property&&(ae.componentsDocumentsDetails.show=!0)}function ce(){ae.componentsDocumentsDetails.show=!1}function pe(e,a,l,t){S.value=a.fileTypeId,1===l.code&&(D.value=!0,F.value={...F.value,...a}),2===l.code&&(ae.JyElMessageBox.header.data="提示？",ae.JyElMessageBox.content.data="您确定要删除该记录吗？",ae.JyElMessageBox.show=!0),3===l.code&&(A.value.fileTypeId=a.fileTypeId,se(a.fileTypeId)),4===l.code&&(O.value=!0)}return k((()=>{te()})),(e,s)=>{const n=h("el-button"),r=h("JyElMessageBox"),c=l;return v(),I(C,null,[j("div",K,[b(N,{url:"/fileType/page",ref_key:"table",ref:q,method:"POST",hasTree:!0,needAutoRequest:!1,componentsSearchForm:g(ae).componentsSearchForm,componentsTableHeader:g(ae).componentsTable.header,componentsBatch:g(ae).componentsBatch,queryParams:d.value,tableClick:"sealName",onCellClick:ue,onCustomClick:pe,onClickBatchButton:re,onGetResult:s[2]||(s[2]=e=>H.value=e)},{title:w((()=>[j("div",G,[W,j("div",$,[j("div",Q,[b(n,{type:"primary",onClick:s[0]||(s[0]=e=>D.value=!0)},{default:w((()=>[_("+ "+x(e.$t("t-zgj-add")),1)])),_:1})]),Z])])])),tree:w((()=>[j("div",X,[b(g(t),{ref:"tree",modelValue:g(ae).componentsTree.value,"onUpdate:modelValue":s[1]||(s[1]=e=>g(ae).componentsTree.value=e),data:g(ae).componentsTree.data,defaultAttribute:g(ae).componentsTree.defaultAttribute,defaultProps:{children:"child",label:"fileTypeName"},onNodeClick:le},null,8,["modelValue","data","defaultAttribute"])])])),_:1},8,["componentsSearchForm","componentsTableHeader","componentsBatch","queryParams"]),j("div",ee,[b(o,{show:g(ae).componentsDocumentsDetails.show,visible:g(ae).componentsDocumentsDetails.visible,onClickClose:ce},null,8,["show","visible"])]),i.value?(v(),T(g(u),{key:0,show:a.value,"onUpdate:show":ne,"onUpdate:searchSelected":ie,searchSelected:M.value,tabsShow:["user","organ","role"]},null,8,["show","searchSelected"])):B("",!0),b(r,{modelValue:g(ae).JyElMessageBox.show,"onUpdate:modelValue":s[3]||(s[3]=e=>g(ae).JyElMessageBox.show=e),show:g(ae).JyElMessageBox.show,defaultAttribute:{},onConfirmClick:oe},{header:w((()=>[_(x(g(ae).JyElMessageBox.header.data),1)])),content:w((()=>[_(x(g(ae).JyElMessageBox.content.data),1)])),_:1},8,["modelValue","show"])]),b(g(R),{modelValue:D.value,"onUpdate:modelValue":s[4]||(s[4]=e=>D.value=e),optionsTree:g(ae).componentsTree.data,onRefresh:te,curFromData:F.value,onOnClosed:de,fileTypePid:d.value.fileTypeIds[0]},null,8,["modelValue","optionsTree","curFromData","fileTypePid"]),b(g(z),{modelValue:O.value,"onUpdate:modelValue":s[5]||(s[5]=e=>O.value=e),fileTypeId:S.value},null,8,["modelValue","fileTypeId"]),b(g(m),{"onUpdate:modelValue":s[6]||(s[6]=e=>g(ae).showToastDialog.show=!1),show:g(ae).showToastDialog.show,selectionData:g(ae).componentsBatch.selectionData,showToastDialogContent:Y.value,label:"formName",onSureAction:oe,curKey:"fileTypeName"},null,8,["show","selectionData","showToastDialogContent"]),b(c,{"onUpdate:modelValue":s[7]||(s[7]=e=>g(ae).showDeleteFTyle.show=!1),show:g(ae).showDeleteFTyle.show,showToastDialogContent:L.value,label:"fileTypeName"},null,8,["show","showToastDialogContent"])],64)}}}),[["__scopeId","data-v-9eb8dd83"]]);export{le as default};

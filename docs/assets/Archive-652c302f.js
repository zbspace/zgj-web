import{B as e,g as a,j as l,F as t,P as i,m as o,a3 as r,n as s}from"./chunk-vform-ec6574e8.js";import{_ as n}from"./gengduo-caozuo-730fe1cb.js";import{J as p}from"./JyTable-8de6d2e9.js";import{c as d}from"./JyTabs-8b1e13a5.js";import{c}from"./documentsDetails-c9f80313.js";import{d as m}from"./portion-e822e6a3.js";import{a as h,at as u,a9 as v,d as f,aQ as b,W as y,X as w,ap as A,ai as F,Y as g,u as k,a3 as T,aE as S,ah as D,an as _,ao as N,am as I,ad as j,ba as C,bb as x}from"./chunk-ant-design-vue-a1de3c57.js";import"./chunk-element-plus-636450f3.js";import"./sangedian-6ea00dcf.js";import"./Layout-58d8fae6.js";import"./searchForm-bc074dfc.js";import"./ketanchude-a94e84bc.js";import"./KDocumentTypeDialog-21febff4.js";import"./pagination-35741a8b.js";import"./batch-21ddcba8.js";import"./index-bd96bee1.js";/* empty css                                                               */import"./cha-kong-c10eac4e.js";import"./table-949645d5.js";/* empty css                                                                         */import"./yuan-hui-31c99901.js";/* empty css                                                                */const z=[{prop:"useSealApplyNo",label:"单据编号",width:180,show:!0},{prop:"useSealFileName",label:"单据名称","min-width":150,show:!0},{prop:"fileTypeName",label:"用印文件类型","min-width":150,show:!0},{prop:"applyUserName",label:"申请人","min-width":150,show:!0},{prop:"applyOrganName",label:"申请部门","min-width":150,show:!0},{prop:"applyDatetime",label:"申请时间",width:180,show:!0},{prop:"caozuo",label:"操作",fixed:"right",align:"center",width:150,show:!0,rankDisplayData:[{name:"文件归档"}]}],U=[{prop:"useSealApplyNo",label:"单据编号",width:180,show:!0},{prop:"useSealFileName",label:"单据名称","min-width":150,show:!0},{prop:"fileTypeName",label:"用印文件类型","min-width":150,show:!0},{prop:"applyUserName",label:"申请人","min-width":150,show:!0},{prop:"applyOrganName",label:"申请部门","min-width":150,show:!0},{prop:"applyDatetime",label:"申请时间",width:180,show:!0},{prop:"caozuo",label:"操作",fixed:"right",width:150,align:"center",show:!0,rankDisplayData:[{name:"文件归档"}]}],B=[{prop:"useSealApplyNo",label:"单据编号",width:180,show:!0},{prop:"useSealFileName",label:"单据名称","min-width":150,show:!0},{prop:"fileTypeName",label:"用印文件类型","min-width":150,show:!0},{prop:"applyUserName",label:"申请人","min-width":150,show:!0},{prop:"applyOrganName",label:"申请部门","min-width":150,show:!0},{prop:"applyDatetime",label:"申请时间",width:180,show:!0},{prop:"download",label:"文件下载",fixed:"right",align:"center","min-width":200,show:!0,rankDisplayData:[{name:"用印前"},{name:"用印中"},{name:"用印后"}]},{prop:"caozuo",label:"操作",fixed:"right","min-width":150,align:"center",show:!0,rankDisplayData:[{name:"补传"},{name:"申请重置"}]}],O=[{id:"searchKey",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"文件名称/申请人员/用印编码"}},{id:"applyDate",label:"申请时间",type:"picker",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD","disabled-date":e=>e.getTime()>Date.now(),"default-value":[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},style:{}},{id:"fileTypeId",requestParams:"fileTypeIds",label:"文件类型",type:"derivable",inCommonUse:!1,defaultAttribute:{placeholder:"请选择",type:"fileType",multiple:!0,joinStr:","},options:[]},{id:"applyUser",requestParams:"applyUserId",label:"申请人",type:"derivable",defaultAttribute:{type:"user",multiple:!0,placeholder:"+申请人",joinStr:","},options:[],values:null},{id:"applyOrgan",requestParams:"applyOrganIds",label:"申请部门",type:"derivable",defaultAttribute:{type:"organ",multiple:!0,placeholder:"+申请部门",joinStr:","},options:[],values:null},{id:"derivable",label:"往来单位",type:"derivable",defaultAttribute:{placeholder:"+往来单位"}},{id:"archiveDate",label:"归档时间",type:"picker",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD","disabled-date":e=>e.getTime()>Date.now(),"default-value":[new Date((new Date).setMonth((new Date).getMonth()-1)),new Date]},style:{}},{id:"useSealStatus",label:"用印状态",type:"checkButton",data:[{id:"1",name:"正常"},{id:"2",name:"异常"}]},{id:"onlyMyself",label:"",type:"checkbox",checkbox:[{defaultAttribute:{label:"我的申请单据"},style:{}}]}],V=[{id:"name",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"文件名称/申请人员/用印编码"}},{id:"picker",label:"申请时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"derivable",label:"文件类型",type:"derivable",defaultAttribute:{placeholder:"+文件类型"}},{id:"derivable",label:"申请人",type:"derivable",defaultAttribute:{placeholder:"+申请人"}},{id:"derivable",label:"申请部门",type:"derivable",defaultAttribute:{placeholder:"+申请部门"}},{id:"derivable",label:"往来单位",type:"derivable",defaultAttribute:{placeholder:"+往来单位"}},{id:"archiveDate",label:"归档时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"wdyy",label:"用印状态",type:"checkButton",data:[{name:"正常"},{name:"异常"}]},{id:"wdyy",label:"",type:"checkbox",checkbox:[{defaultAttribute:{label:"我的申请单据"},style:{}}]}],M=[{id:"name",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"文件名称/申请人员/用印编码"}},{id:"picker",label:"申请时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"derivable",label:"文件类型",type:"derivable",defaultAttribute:{placeholder:"+文件类型"}},{id:"derivable",label:"申请人",type:"derivable",defaultAttribute:{placeholder:"+申请人"}},{id:"derivable",label:"申请部门",type:"derivable",defaultAttribute:{placeholder:"+申请部门"}},{id:"derivable",label:"往来单位",type:"derivable",defaultAttribute:{placeholder:"+往来单位"}},{id:"archiveDate",label:"归档时间",type:"picker",pickerType:"date",inCommonUse:!0,defaultAttribute:{type:"daterange","start-placeholder":"开始时间","end-placeholder":"结束时间"},style:{}},{id:"wdyy",label:"用印状态",type:"checkButton",data:[{name:"正常"},{name:"异常"}]},{id:"wdyy",label:"",type:"checkbox",checkbox:[{defaultAttribute:{label:"我的申请单据"},style:{}}]}],P={archiveInfo:a=>e({method:"GET",url:"/archive/info/"+a}),archiveFileFinish:a=>e({method:"POST",url:"/archive/file/finish",data:a}),archiveDelete:a=>e({method:"POST",url:"/archive/file/delete",params:a}),archiveFinish:a=>e({method:"POST",url:"/archive/finish",data:a}),archiveRestApply:a=>e({method:"POST",url:"/archive/reset/apply",params:a}),archiveRestCancel:a=>e({method:"POST",url:"/archive/reset/cancel",params:a}),archiveDownloadPack:a=>e({method:"get",url:"/archive/download/pack",params:a}),archiveDownloadPage:a=>e({method:"GET",url:"/archive/download/page",params:a}),archiveDownloadDelete:a=>e({method:"GET",url:"/archive/download/delete",params:a})},Y=e=>(C("data-v-812c00ea"),e=e(),x(),e),H={class:"PrintControlManagement-Archive"},Z={class:"title"},q=Y((()=>g("div",null,"文件归档",-1))),E={class:"title-more"},R=Y((()=>g("div",{class:"title-more-add"},null,-1))),$={key:0,class:"title-more-down"},J=Y((()=>g("img",{class:"button-icon",src:n,alt:"",srcset:""},null,-1))),K=Y((()=>g("span",null,"更多操作",-1))),G={class:"ap-box"},L=Y((()=>g("div",{class:"ap-cont-box-title-label"},"基本信息",-1))),W={class:"from-wrap"},X=Y((()=>g("div",{class:"ap-cont-box-title-label"},"文件归档",-1))),Q={key:0,class:"files-wrap content-wrap"},ee=Y((()=>g("span",null,"文件归档",-1))),ae={class:"files-list"},le={key:0,class:"add-file"},te=Y((()=>g("svg",{preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"",viewBox:"0 0 16 16"},[g("g",null,[g("g",{"fill-rule":"nonzero",fill:"#1985F5","data-follow-fill":"#1985F5"},[g("path",{d:"M6.155 3.84h3.2v6.368h-3.2z"}),g("path",{d:"M6.155 3.84h3.2v6.368h-3.2z"}),g("path",{d:"m3.19 5.003 1.29-1.408L7.061.757 7.755 0l.693.757 2.581 2.838 1.291 1.408H3.19ZM8.32 9.77l-.395.437h-.341l-.395-.437H8.32Z"}),g("path",{d:"M6.155 9.6v.608h3.2V9.6h-3.2Zm4.266 0v1.707H5.088V9.6H0V16h16V9.6h-5.579Zm1.312 5.184H9.6v-2.133h2.133v2.133Zm3.2 0H12.8v-2.133h2.133v2.133Z"})])])],-1))),ie=_(" 请添加归档文件 "),oe={class:"upload-file"},re={key:0},se=Y((()=>g("img",{src:"/zgj-web/assets/icon-pdf-2f424dcd.svg"},null,-1))),ne={key:1},pe=Y((()=>g("svg",{class:"iconpark-icon"},[g("use",{href:"#folder"})],-1))),de={class:"archive-status"},ce={key:0,class:"archive-status-item"},me=[Y((()=>g("svg",{class:"iconpark-icon"},[g("use",{href:"#finished"})],-1))),_(" 完成归档 ")],he={key:1,class:"archive-status-item"},ue=_("完成归档"),ve={key:1},fe=[Y((()=>g("svg",{class:"iconpark-icon"},[g("use",{href:"#waiting-arvhices"})],-1))),Y((()=>g("span",null,"归档中（其他终端）",-1)))],be={class:"files-add content-wrap"},ye=Y((()=>g("span",null,"补充附件",-1))),we={class:"upload-archives-element"},Ae=Y((()=>g("svg",{class:"iconpark-icon"},[g("use",{href:"#upload-file"})],-1))),Fe=_(" 添加附件 "),ge={class:"upload-files-list"},ke=["title"],Te={class:"file-size"},Se=Y((()=>g("div",{class:"file-status file-btn"},"已上传",-1))),De=Y((()=>g("div",{class:"file-view file-btn"},"预览",-1))),_e=Y((()=>g("div",{class:"file-down file-btn"},"下载",-1))),Ne=Y((()=>g("div",{class:"file-delete file-btn"},"删除",-1))),Ie=a({setup(e){const a=l(),n=h(!1),C=h("shallArchive"),x=h(null),Y=h(null),Ie=h({shallArchive:z,archiving:U,archived:B}),je=h({shallArchiveSearchForm:O,archivingSearchForm:V,archivedSearchForm:M}),Ce=u({show:!1,title:"文件归档"}),xe=u({cache:{},componentsTitle:{more:{data:[]}},componentsTabs:{data:[{label:"待归档",name:"shallArchive"},{label:"归档中",name:"archiving"},{label:"已归档",name:"archived"}]},componentsSearchForm:{data:je.value.shallArchiveSearchForm,butData:[{id:"more",name:"展开",type:"unfold",defaultAttribute:{type:"primary"},style:{}},{id:"inquire",name:"t-zgj-query",label:"查询",type:"click",defaultAttribute:{type:"primary"},style:{}},{id:"reset",name:"t-zgj-reset",label:"重置",type:"click",defaultAttribute:{plain:!0},style:{}}]},componentsTable:{header:Ie.value.shallArchive},componentsDocumentsDetails:{show:!1,visible:[{label:"用印详情",name:"Details-of-Printing"},{label:"审批流程",name:"approval-process"},{label:"领用记录",name:"Record-of-requisition"},{label:"操作记录",name:"operating-record"}]},componentsBatch:{selectionData:[],defaultAttribute:{disabled:!0},data:[]},componentsArchiveForm:{useSealApplyId:"",fileTypeId:"",applyCode:"",applyName:"",archiveNo:"",readme:"",files:[],supplemenFiles:[]}});function ze(e,a,l,t){"useSealFileName"===a.property&&(xe.componentsDocumentsDetails.show=!0)}function Ue(){xe.componentsDocumentsDetails.show=!1}function Be(e){C.value=e,xe.componentsTable.header=Ie.value[e],"shallArchive"===e||"archiving"===e?xe.componentsTitle.more.data=[]:"archived"===e&&(xe.componentsTitle.more.data=[{name:"文件打包下载"},{name:"下载记录"}]),x.value.clickSubmit()}const Oe=(e,l,t,i)=>{"文件归档"===t.name&&(Ce.show=!0,P.archiveInfo(l.useSealApplyId).then((e=>{const a=e.data;xe.componentsArchiveForm.useSealApplyId=a.useSealApplyId,xe.componentsArchiveForm.fileTypeId=a.fileTypeId,xe.componentsArchiveForm.applyCode=a.useSealApplyNo,xe.componentsArchiveForm.applyName=a.useSealFileName,xe.componentsArchiveForm.files=[],xe.componentsArchiveForm.supplemenFiles=a.archiveAddFile,a.useSealFile.forEach((e=>{var a;xe.componentsArchiveForm.files.push({fileOriginName:e.fileOriginName,bizFileId:e.bizFileId,fileSize:(e.fileSizeByte/1024).toFixed(2)+"KB",type:e.archiveFile?2:-1,archiveAttachmentFileName:null==(a=e.archiveFile)?void 0:a.fileOriginName,isArchived:!!e.archiveFile})})),Y.value={useSealApplyId:a.useSealApplyId,useSealFileTypeId:a.fileTypeId,joinBizFileId:"",fileSourceType:"1"}}))),"补传"===t.name&&(Ce.show=!0,xe.ArchiveFiles=[]),"申请重置"===t.name&&a.push({name:"ArchiveReset"})};function Ve(e){const a=xe.componentsArchiveForm.files.findIndex((a=>a.bizFileId===e.data.joinBizFileId));a>-1&&(xe.componentsArchiveForm.files[a].type=2,xe.componentsArchiveForm.files[a].archiveAttachmentFileName=e.data.fileOriginName,xe.componentsArchiveForm.files[a].isArchived=!1,xe.componentsArchiveForm.files[a].fileSourceType=e.data.fileSourceType,xe.componentsArchiveForm.files[a].bizFileId=e.data.bizFileId)}function Me(e){e.data.fileUrl=e.data.fileUrl?t+e.data.fileUrl:"",xe.componentsArchiveForm.supplemenFiles.push(e.data)}function Pe(){const e=xe.componentsArchiveForm.files.filter((e=>e.isArchived)).length;e&&e===xe.componentsArchiveForm.files.length?P.archiveFinish({useSealApplyId:xe.componentsArchiveForm.useSealApplyId,archiveNo:xe.componentsArchiveForm.archiveNo,readme:xe.componentsArchiveForm.readme}).then((()=>{Ce.show=!1,r("归档成功"),x.value.reloadData()})):o("请先完成文件归档")}function Ye(){xe.componentsArchiveForm.archiveNo="",xe.componentsArchiveForm.readme=""}return v((()=>{})),f((()=>{})),(e,a)=>{const l=b("el-button"),o=b("el-dropdown-item"),r=b("el-dropdown-menu"),h=b("el-dropdown"),u=b("el-input"),v=b("el-form-item"),f=b("el-col"),z=b("el-row"),U=b("el-form"),B=b("el-upload"),O=s;return y(),w("div",H,[A(p,{url:`/archive/page/${C.value}`,ref_key:"jyTable",ref:x,hasTabs:"",componentsSearchForm:k(xe).componentsSearchForm,componentsTableHeader:k(xe).componentsTable.header,componentsBatch:k(xe).componentsBatch,tableClick:"useSealFileName",onCellClick:ze,onCustomClick:Oe,onClickBatchButton:e.clickBatchButton},{title:F((()=>[g("div",Z,[q,g("div",E,[R,k(xe).componentsTitle.more.data.length>0?(y(),w("div",$,[A(h,null,{dropdown:F((()=>[A(r,null,{default:F((()=>[(y(!0),w(T,null,S(k(xe).componentsTitle.more.data,((a,l)=>(y(),D(o,{key:l,onClick:l=>e.moreClick(a)},{default:F((()=>[_(N(a.name),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:F((()=>[A(l,null,{default:F((()=>[J,K])),_:1})])),_:1})])):I("",!0)])])])),tabs:F((()=>[g("div",null,[A(d,{activeName:C.value,data:k(xe).componentsTabs.data,onTabChange:Be},null,8,["activeName","data"])])])),_:1},8,["url","componentsSearchForm","componentsTableHeader","componentsBatch","onClickBatchButton"]),g("div",G,[A(c,{show:k(xe).componentsDocumentsDetails.show,visible:k(xe).componentsDocumentsDetails.visible,onClickClose:Ue},null,8,["show","visible"])]),A(O,{"onUpdate:show":a[4]||(a[4]=e=>k(Ce).show=e),show:k(Ce).show,title:"文件归档",centerBtn:"",draggable:!0,confirmText:e.$t("t-zgj-operation.submit"),concelText:e.$t("t-zgj-operation.cancel"),onClose:Ye,onConfirm:Pe},{default:F((()=>[A(m,null,{title:F((()=>[L])),content:F((()=>[g("div",W,[A(U,{"label-width":"70px","label-position":"left"},{default:F((()=>[A(z,{gutter:15},{default:F((()=>[A(f,{span:12},{default:F((()=>[A(v,{label:"单据编号",prop:"applyCode"},{default:F((()=>[A(u,{modelValue:k(xe).componentsArchiveForm.applyCode,"onUpdate:modelValue":a[0]||(a[0]=e=>k(xe).componentsArchiveForm.applyCode=e),disabled:"",type:"text",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),A(f,{span:12},{default:F((()=>[A(v,{label:"单据名称",prop:"applyName"},{default:F((()=>[A(u,{modelValue:k(xe).componentsArchiveForm.applyName,"onUpdate:modelValue":a[1]||(a[1]=e=>k(xe).componentsArchiveForm.applyName=e),disabled:"",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),A(f,{span:24},{default:F((()=>[A(v,{label:"档案字号",prop:"archiveNo"},{default:F((()=>[A(u,{modelValue:k(xe).componentsArchiveForm.archiveNo,"onUpdate:modelValue":a[2]||(a[2]=e=>k(xe).componentsArchiveForm.archiveNo=e),placeholder:"请输入",clearable:"",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),A(f,{span:24},{default:F((()=>[A(v,{label:"归档备注",prop:"readme"},{default:F((()=>[A(u,{modelValue:k(xe).componentsArchiveForm.readme,"onUpdate:modelValue":a[3]||(a[3]=e=>k(xe).componentsArchiveForm.readme=e),type:"textarea",placeholder:"请输入",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])])),_:1}),A(m,null,{title:F((()=>[X])),content:F((()=>[k(xe).componentsArchiveForm.files.length>0?(y(),w("div",Q,[ee,g("div",ae,[(y(!0),w(T,null,S(k(xe).componentsArchiveForm.files,((e,a)=>(y(),w("div",{class:"files-item",key:a},[g("div",null,N(e.fileOriginName),1),e.type<2?(y(),w("div",le,[A(B,{ref_for:!0,ref:"upload",class:"upload-demo",action:`${k(t)}/archive/file/upload`,limit:1,data:{useSealApplyId:k(xe).componentsArchiveForm.useSealApplyId,useSealFileTypeId:k(xe).componentsArchiveForm.fileTypeId,joinBizFileId:e.bizFileId,fileSourceType:"1"},"on-success":Ve,"show-file-list":!1},{trigger:F((()=>[te,ie])),_:2},1032,["action","data"])])):I("",!0),2==e.type?(y(),w("div",{key:1,class:j(["view-file",{special:"1"===e.fileSourceType}])},[g("div",oe,[e.isArchived?(y(),w("div",re,[se,_(N(e.archiveAttachmentFileName)+"（"+N(e.fileSize)+"） ",1)])):(y(),w("div",ne,[pe,_(" "+N(e.archiveAttachmentFileName),1)]))]),g("div",de,[e.isArchived?(y(),w("div",ce,me)):(y(),w("div",he,["1"===e.fileSourceType?(y(),D(l,{key:0,style:{"margin-right":"20px"},type:"primary",onClick:e=>function(e){P.archiveFileFinish({bizFileId:xe.componentsArchiveForm.files[e].bizFileId}).then((()=>{xe.componentsArchiveForm.files[e].isArchived=!0,xe.componentsArchiveForm.files[e].fileSourceType=null,x.value.reloadData()}))}(a)},{default:F((()=>[ue])),_:2},1032,["onClick"])):(y(),w("div",ve,fe))]))])],2)):I("",!0)])))),128))])])):I("",!0),g("div",be,[ye,g("div",we,[A(B,{ref:"upload",class:"upload-demo",action:`${k(t)}/archive/file/upload/add`,limit:1,data:Y.value,"show-file-list":!1,"on-success":Me},{trigger:F((()=>[Ae,Fe])),_:1},8,["action","data"]),g("div",ge,[(y(!0),w(T,null,S(k(xe).componentsArchiveForm.supplemenFiles,((e,a)=>(y(),w("div",{class:"upload-file-item",key:a},[g("div",{class:"file-name",title:e.fileOriginName},N(e.fileOriginName),9,ke),g("div",Te,N((e.fileSizeByte/1024).toFixed(2)+"KB"),1),Se,De,_e,Ne])))),128))])])])])),_:1})])),_:1},8,["show","confirmText","concelText"]),n.value?(y(),D(k(i),{key:0,show:n.value,"onUpdate:show":a[5]||(a[5]=e=>n.value=e)},null,8,["show"])):I("",!0)])}}},[["__scopeId","data-v-812c00ea"]]);export{Ie as default};

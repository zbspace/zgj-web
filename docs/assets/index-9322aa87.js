import{g as e,a2 as a,G as t,a3 as o,E as l,F as s,D as r,P as d,i as n,n as c}from"./chunk-vform-d740b35c.js";import{_ as m}from"./gengduo-caozuo-730fe1cb.js";import{_ as i}from"./ketanchude-a94e84bc.js";import{J as u}from"./JyTable-d62bb35b.js";import{c as p}from"./documentsDetails-8b022303.js";import{m as h}from"./md5-044d60c1.js";import{r as g,j as f,b,w as D,n as w,C as v,F as S,G as y,B as F,N as T,H as _,L as I,I as x,R as A,u as B,Q as U,J as E,c as O,V as j,W as N,E as V,a1 as C,_ as M,P as k,U as z}from"./chunk-element-plus-a77de3d2.js";import{a as P}from"./department-66227f1b.js";import{a as J}from"./actionMoreDialog-7035c1c1.js";import{a as $}from"./actionOneDialog-54db6636.js";import"./sangedian-6ea00dcf.js";import"./Layout-e90710df.js";import"./searchForm-96cc0cf8.js";import"./KDocumentTypeDialog-63de8919.js";import"./pagination-3c925a2b.js";import"./batch-6eb7c760.js";import"./index-d761d72f.js";import"./cha-kong-c10eac4e.js";import"./JyTabs-726242c5.js";/* empty css                                                               */import"./table-e0a114b8.js";/* empty css                                                                         */import"./portion-e63dfdb7.js";/* empty css                                                                */import"./yuan-hui-31c99901.js";const L=e=>(j("data-v-a0f61b00"),e=e(),N(),e),G={class:"jy-message-box"},R={class:"header-div"},q=[L((()=>_("svg",{class:"iconpark-icon"},[_("use",{href:"#Vector"})],-1)))],W=A("手动输入"),Y=A("随机生成"),H=L((()=>_("div",{class:"tips"},"提示：当员工存在手机号时会以短信的形式向员工发送随机密码，否则重置后请告知员工，以确保其正常登录",-1))),K=e({props:{show:{type:Boolean,default:!1},userIds:{type:Array,default:()=>[]},title:{type:String,default:"重置密码"}},emits:["update:show","on-confirm","on-cancel"],setup(e,{emit:s}){const r=e,d=g(null),n=f({get:()=>r.show,set(e){s("update:show",e)}}),c=b({formData:{newPassword:"",resetType:"1"},formRules:{resetType:[{required:!0,message:"请选择重置方式",trigger:"change"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}]}});D((()=>r.show),(()=>{r.show&&w((()=>{d.value.resetFields(),c.formData.newPassword="",c.formData.resetType="1"}))}));const m=()=>{"2"===c.formData.resetType?i():c.formData.newPassword=null},i=()=>{const e=N(8);c.formData.newPassword=e},u=()=>{c.props.show=!1},p=()=>{d.value.validate((e=>{e&&("t-zgj-findpwd.resetPassword"===r.title&&t.userResetPassword({newPassword:h(c.formData.newPassword),userId:r.userIds[0]}).then((e=>{200===e.code?(s("on-confirm"),o("重置密码成功")):l("重置密码失败，请重试！")})),"t-zgj-findpwd.batchResetPassword"===r.title&&t.userBatchResetPassword({newPassword:c.formData.newPassword,userIds:r.userIds}).then((e=>{200===e.code?(s("on-confirm"),o("批量重置密码成功")):l("重置密码失败，请重试！")})))})),n.value=!1},j=e=>{s("on-cancel",e),n.value=!1},N=e=>{const a=[],t=()=>Math.floor(10*Math.random()),o=()=>String.fromCharCode(Math.floor(26*Math.random())+65),l=()=>String.fromCharCode(Math.floor(26*Math.random())+97),s=[t,o,l],r=()=>s[Math.floor(3*Math.random())]();Array(e-3).fill("").forEach((()=>{a.push(r())}));const d=[t(),o(),l()];return a.push(...d),a.join("")};return(e,t)=>{const o=v("el-radio"),l=v("el-radio-group"),s=v("el-form-item"),h=v("el-input"),g=v("el-col"),f=v("el-icon"),b=v("el-row"),D=v("el-form"),w=v("el-button"),N=v("el-dialog");return S(),y("div",G,[F(N,{modelValue:B(n),"onUpdate:modelValue":t[2]||(t[2]=e=>O(n)?n.value=e:null),"before-close":u,"show-close":!1,"destroy-on-close":"","close-on-press-escape":!1,"close-on-click-modal":!1,width:"40%","align-center":""},{header:T((()=>[_("div",null,[I(e.$slots,"header",{},(()=>[_("div",R,[_("span",null,x(e.$t(r.title)),1)])]),!0)]),_("div",{class:"dialog-header-remove",onClick:j},q)])),footer:T((()=>[F(w,{type:"primary",onClick:p},{default:T((()=>[A(x(e.$t("t-zgj-operation.submit")),1)])),_:1}),F(w,{onClick:j},{default:T((()=>[A(x(e.$t("t-zgj-operation.cancel")),1)])),_:1})])),default:T((()=>[F(D,{model:B(c).formData,rules:B(c).formRules,ref_key:"passwordForm",ref:d,"label-width":"80"},{default:T((()=>[F(s,{label:"重置方式",prop:"resetType",onChange:m},{default:T((()=>[F(l,{modelValue:B(c).formData.resetType,"onUpdate:modelValue":t[0]||(t[0]=e=>B(c).formData.resetType=e)},{default:T((()=>[F(o,{label:"1"},{default:T((()=>[W])),_:1}),F(o,{label:"2"},{default:T((()=>[Y])),_:1})])),_:1},8,["modelValue"])])),_:1}),F(s,{label:"新密码",prop:"newPassword"},{default:T((()=>[F(b,{gutter:10},{default:T((()=>[F(g,{span:"2"===B(c).formData.resetType?22:24},{default:T((()=>[F(h,{modelValue:B(c).formData.newPassword,"onUpdate:modelValue":t[1]||(t[1]=e=>B(c).formData.newPassword=e),placeholder:"请输入新密码",disabled:"2"===B(c).formData.resetType},null,8,["modelValue","disabled"])])),_:1},8,["span"]),"2"===B(c).formData.resetType?(S(),U(g,{key:0,span:2},{default:T((()=>[_("div",{onClick:i},[F(f,{class:"refresh-icon"},{default:T((()=>[F(B(a))])),_:1})])])),_:1})):E("",!0)])),_:1})])),_:1})])),_:1},8,["model","rules"]),H])),_:3},8,["modelValue"])])}}},[["__scopeId","data-v-a0f61b00"]]),Q=e=>(j("data-v-cb04f702"),e=e(),N(),e),X={class:"jy-message-box"},Z={class:"header-div"},ee=[Q((()=>_("svg",{class:"iconpark-icon"},[_("use",{href:"#Vector"})],-1)))],ae=Q((()=>_("div",{class:"el-upload__tip"}," 1.支持上传JPG/JPEG/PNG格式的人脸图片，大小不超过5M ",-1))),te=Q((()=>_("div",{class:"el-upload__tip"},"2.请尽量保证人脸图形完整清晰，没有遮挡 ",-1))),oe={class:"dialog-footer"},le=e({props:{userId:{type:Array,default:()=>[]},userFaceUri:{type:String,default:""},userUpdateFaceId:{type:String,default:""},show:{type:Boolean,default:!1}},emits:["update:modelValue","on-confirm","on-cancel"],setup(e,{emit:a}){const d=e,n=g(null);D((()=>d.userUpdateFaceId),(e=>{w((()=>{e&&(m.formData.userFaceId=e)}))}));const c=f({get:()=>d.show,set(e){a("update:modelValue",e)}}),m=b({formData:{userFaceId:"",userFaceUri:""},formRules:{userFaceId:[{required:!0,message:"",trigger:"change"}]},fileList:""}),i=e=>{m.formData.userFaceId=e.data.fileId,m.formData.userFaceUri=s+e.data.fileUrl},u=()=>{a("on-cancel"),m.formData.userFaceUri="",m.formData.userFaceId="",m.props.show=!1},p=()=>{n.value.validate((e=>{e?t.editOrganUserFace({userId:d.userId,fileId:m.formData.userFaceId,fileSourceType:"1"}).then((()=>{o("人脸设置成功"),m.formData.userFaceUri="",m.formData.userFaceId="",a("on-confirm")})):V.error("请上传人脸照片")}))},h=()=>{a("on-cancel")},E=e=>{const a="image/jpeg"===e.type||"image/jpg"===e.type||"image/png"===e.type,t=e.size/1024/1024<5;return a||l("上传头像图片只能是 JPG/JPEG/PNG 格式!"),t||l("上传头像图片大小不能超过 5MB!"),a&&t};return(e,a)=>{const t=v("el-image"),o=v("el-icon"),l=v("el-upload"),g=v("el-form-item"),f=v("el-form"),b=v("el-button"),D=v("el-dialog");return S(),y("div",X,[F(D,{title:"{{ $t(t-zgj-F_SEAL_CONSOLE_FACE_SETTING) }}",modelValue:B(c),"onUpdate:modelValue":a[0]||(a[0]=e=>O(c)?c.value=e:null),"before-close":u,"show-close":!1,"destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1,width:"600","align-center":"",draggable:""},{header:T((()=>[_("div",null,[I(e.$slots,"header",{},(()=>[_("div",Z,[_("span",null,x(e.$t("t-zgj-F_SEAL_CONSOLE_FACE_SETTING")),1)])]),!0)]),_("div",{class:"dialog-header-remove",onClick:h},ee)])),footer:T((()=>[_("span",oe,[F(b,{type:"primary",onClick:p},{default:T((()=>[A(x(e.$t("t-zgj-operation.submit")),1)])),_:1}),F(b,{onClick:h},{default:T((()=>[A(x(e.$t("t-zgj-operation.cancel")),1)])),_:1})])])),default:T((()=>[F(f,{model:B(m).formData,rules:B(m).formRules,ref_key:"uploadForm",ref:n},{default:T((()=>[F(g,{label:"人脸照片",prop:"userFaceId"},{default:T((()=>[F(l,{class:"avatar-uploader",action:`${B(s)}/user/uploadUserFace`,"show-file-list":!1,"list-type":"picture-card","before-upload":E,"on-success":i},{tip:T((()=>[ae,te])),default:T((()=>[B(m).formData.userFaceUri||d.userFaceUri?(S(),U(t,{key:0,src:B(m).formData.userFaceUri||d.userFaceUri,style:{padding:"6px"}},{error:T((()=>[])),_:1},8,["src"])):(S(),U(o,{key:1,class:"avatar-uploader-icon"},{default:T((()=>[F(B(r))])),_:1}))])),_:1},8,["action"])])),_:1})])),_:1},8,["model","rules"])])),_:3},8,["modelValue"])])}}},[["__scopeId","data-v-cb04f702"]]),se=[{prop:"userName",label:"姓名",flex:!0,"min-width":150,show:!0},{prop:"accountNo",label:"账号","min-width":150,show:!0},{prop:"hostOrganName",label:"所属部门","min-width":150,show:!0},{prop:"userTitle",label:"职位","min-width":150,show:!0},{prop:"faceState",label:"人脸状态","min-width":150,show:!0},{prop:"flag",label:"状态","min-width":150,show:!0},{prop:"caozuo",label:"操作",fixed:"right","min-width":365,show:!0,align:"center",rankDisplayData:[{name:"t-zgj-Edit"},{name:"status"},{name:"t-zgj-Delete"},{name:"t-zgj-findpwd.resetPassword"},{name:"t-zgj-F_SEAL_CONSOLE_FACE_SETTING"}]}],re=e=>(j("data-v-a8bd7420"),e=e(),N(),e),de={class:"title"},ne={class:"title-more"},ce={class:"title-more-add"},me={class:"title-more-down"},ie=re((()=>_("img",{class:"button-icon",src:m,alt:"",srcset:""},null,-1))),ue={class:"components-tree"},pe={class:"select-box-contBox"},he={class:"ap-box-contBox-icon"},ge={class:"ap-box-contBox"},fe=[re((()=>_("img",{class:"ap-box-contBox-icon-img",src:i,alt:""},null,-1)))],be={class:"select-box-contBox"},De={class:"ap-box-contBox-icon"},we={class:"ap-box-contBox"},ve=[re((()=>_("img",{class:"ap-box-contBox-icon-img",src:i,alt:""},null,-1)))],Se={key:1,class:"iconpark-icon",style:{width:"28px",color:"var(--el-text-color-secondary)"}},ye=[re((()=>_("use",{href:"#icon-add"},null,-1)))],Fe=re((()=>_("div",{class:"el-upload__tip"},"1.支持上传JPG/JPEG/PNG格式的人脸图片，大小不超过5M",-1))),Te=re((()=>_("div",{class:"el-upload__tip"},"2.请尽量保证人脸图形完整清晰，没有遮挡",-1))),_e={class:"ap-box"},Ie=e({setup(e){const a=g(!1),o=g(!1),r=g(null),m=g(null),h=g(!1),f=g("t-zgj-index.updatePwd"),D=g(!1),I=g("-1"),O=g(null),j=g(null),N=g([]),L=g(!1),G=b({showToastDialog:{show:!1,header:{data:"",icon:"/src/assets/svg/common/warning.svg"},content:{data:""},type:"批量删除",oneBtn:!1,confirmText:"t-zgj-know"},title:"t-zgj-add",tabsShow:["organ"],multiple:!0,tabSelects:{searchSelected:[],hostOrganSelected:[],rolesSelected:[],leaderUserSelected:[],partTimeOrgansSelected:[]},JyElMessageBox:{show:!1,header:{data:"",icon:"/src/assets/svg/common/warning.svg"},content:{data:""},type:"删除",oneBtn:!1,confirmText:"",column:{}},componentsAddForm:{formData:{userId:"",userName:"",accountNo:"",userTel:"",hostOrganId:"",hostOrganName:"",partTimeOrganIds:[],partTimeOrgans:[],userTitle:"",userMail:"",roleIds:[],roles:[],qweiNo:"",dingdingNo:"",userNo:"",leaderUserId:"",leaderUserName:"",userFaceId:"",readme:""},formRules:{userName:[{required:!0,message:"请输入姓名",trigger:"change"}],accountNo:[{required:!0,message:"请输入帐号",trigger:"change"}],userTel:[{required:!0,message:"请输入正确的手机号",pattern:/^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d{8}$/,trigger:"change"}],hostOrganName:[{required:!0,message:"请选择所属部门",trigger:"change"}],roleIds:[{required:!0,message:"请选择角色",trigger:"change"}]}},componentsSearchForm:{data:[{id:"keyWord",label:"关键词",type:"input",inCommonUse:!0,defaultAttribute:{placeholder:"姓名/账号/职位"}},{id:"flag",label:"状态",type:"select",inCommonUse:!0,options:[{status:"0",statusLabel:"停用"},{status:"1",statusLabel:"启用"}],optionLabel:"statusLabel",optionValue:"status",defaultAttribute:{placeholder:"请选择"}},{id:"faceState",label:"人脸状态",type:"select",inCommonUse:!1,options:[{faceState:"0",faceStateLabel:"未绑定"},{faceState:"1",faceStateLabel:"已绑定"}],optionLabel:"faceStateLabel",optionValue:"faceState",defaultAttribute:{placeholder:"请选择"}}],butData:[{id:"more",name:"展开",type:"unfold",defaultAttribute:{type:"primary"},style:{}},{id:"inquire",name:"t-zgj-query",label:"查询",type:"click",defaultAttribute:{type:"primary"},style:{}},{id:"reset",name:"t-zgj-reset",label:"重置",type:"click",defaultAttribute:{},style:{}}]},componentsTable:{header:se},componentsTree:{data:[],defaultAttribute:{"check-on-click-node":!0,"show-checkbox":!1,"expand-on-click-node":!1,"check-strictly":!0,"highlight-current":!0,"node-key":"organId","current-node-key":"-1",accordion:!0},defaultProps:{label:"organName",children:"children",isLeaf:"haveChildren"},value:""},componentsDocumentsDetails:{show:!1,visible:[{label:"员工详情",name:"Staff-Details"}]},componentsBatch:{selectionData:[],defaultAttribute:{disabled:!0},data:[{name:"t-zgj-dept.BatchDeactivation"},{name:"t-zgj-dept.BatchEnable"},{name:"t-zgj-seal.BatchDelete"},{name:"t-zgj-findpwd.batchResetPassword"}],userIds:[]},userUpdateFaceUri:"",userUpdateFaceId:""});function R(e,a){if(0===e.level)j.value=e,P.subOrganList(-1).then((e=>(e.data.forEach((e=>e.haveChildren=!e.haveChildren)),N.value=e.data,a([{organName:n("accountInfo")&&n("accountInfo").userDepartName,organId:"-1",haveChildren:!1,children:[]}])))).then((()=>{w((()=>{const e=j.value.childNodes[0];e.expanded=!0,e.loadData()}))}));else{if(1===e.level)return a(N.value);P.subOrganList(e.data.organId).then((e=>(e.data.forEach((e=>e.haveChildren=!e.haveChildren)),a(e.data))))}}const q=()=>{h.value=!1,D.value=!1,O.value.reloadData()},W=()=>{h.value=!1,D.value=!1},Y=()=>{G.title="t-zgj-add",a.value=!0,G.tabSelects.partTimeOrgansSelected=[],G.componentsAddForm.formData.partTimeOrganIds=[],G.componentsAddForm.formData.partTimeOrgans=[],G.tabSelects.rolesSelected=[],G.componentsAddForm.formData.roleIds=[],G.componentsAddForm.formData.roles=[];for(const e in G.componentsAddForm.formData)Array.isArray(e)||(G.componentsAddForm.formData[e]="");w((()=>{r.value.resetFields()}))},H=(e,a)=>{m.value=e,G.multiple=a,G.tabsShow=[],G.tabSelects.searchSelected=[],"hostOrgan"===m.value&&(G.tabsShow=["organ"],G.tabSelects.searchSelected=G.tabSelects.hostOrganSelected),"partTimeOrgan"===m.value&&(G.tabsShow=["organ"],G.tabSelects.searchSelected=G.tabSelects.partTimeOrgansSelected.length>0?G.tabSelects.partTimeOrgansSelected.map((e=>({id:e.value,name:e.label,haveChildren:e.haveChildren,type:"organ"}))):[]),"roles"===m.value&&(G.tabsShow=["role"],G.tabSelects.searchSelected=G.tabSelects.rolesSelected,G.tabSelects.searchSelected=G.tabSelects.rolesSelected.length>0?G.tabSelects.rolesSelected.map((e=>({id:e.value,name:e.label,type:"role"}))):[]),"leaderUser"===m.value&&(G.tabsShow=["user"],G.tabSelects.searchSelected=G.tabSelects.leaderUserSelected),o.value=!0},Q=e=>{"hostOrgan"===m.value&&(G.tabSelects.hostOrganSelected=e,G.componentsAddForm.formData.hostOrganName=e[0].name,G.componentsAddForm.formData.hostOrganId=e[0].id),"partTimeOrgan"===m.value&&(G.tabSelects.partTimeOrgansSelected=[],G.componentsAddForm.formData.partTimeOrgans=[],e.length>0&&(G.tabSelects.partTimeOrgansSelected=e.map((e=>({label:e.name,value:e.id,type:"organ",haveChildren:e.haveChildren}))),G.componentsAddForm.formData.partTimeOrganIds=e.map((e=>e.id)))),"roles"===m.value&&(G.tabSelects.rolesSelected=[],G.componentsAddForm.formData.roles=[],e.length>0&&(G.tabSelects.rolesSelected=e.map((e=>({label:e.name,value:e.id,type:"role"}))),G.componentsAddForm.formData.roleIds=e.map((e=>e.id)))),"leaderUser"===m.value&&(G.tabSelects.leaderUserSelected=e,G.componentsAddForm.formData.leaderUserId=e[0].id,G.componentsAddForm.formData.leaderUserName=e[0].name),o.value=!1},X=e=>{G.componentsAddForm.formData.fileId=e.data.fileId,G.componentsAddForm.formData.userFaceId=e.data.fileId,G.componentsAddForm.formData.userFaceUri=e.data.fileUrl},Z=e=>{const a="image/jpeg"===e.type||"image/jpg"===e.type||"image/png"===e.type,t=e.size/1024/1024<5;return a||l("上传头像图片只能是 JPG/JPEG/PNG 格式!"),t||l("上传头像图片大小不能超过 5MB!"),a&&t},ee=(e,a)=>{const t=G.componentsBatch.selectionData=a,o=[];t.forEach((e=>{o.push(e.userId)})),G.componentsBatch.userIds=o,"t-zgj-dept.BatchDeactivation"===e.name&&(G.showToastDialog.header.data="t-zgj-dept.BatchDeactivation",G.showToastDialog.content.data="已选中以下用户，请问确定要批量停用吗？",G.showToastDialog.show=!0,G.showToastDialog.type="批量停用"),"t-zgj-dept.BatchEnable"===e.name&&(G.showToastDialog.header.data="t-zgj-dept.BatchEnable",G.showToastDialog.content.data="已选中以下用户，请问确定要批量启用吗？",G.showToastDialog.show=!0,G.showToastDialog.type="批量启用"),"t-zgj-seal.BatchDelete"===e.name&&(G.showToastDialog.header.data="t-zgj-seal.BatchDelete",G.showToastDialog.content.data="已选中以下用户，请问确定要批量删除吗？",G.showToastDialog.show=!0,G.showToastDialog.type="批量删除"),"t-zgj-findpwd.batchResetPassword"===e.name&&(f.value="t-zgj-findpwd.batchResetPassword",h.value=!0)};function ae(e,a,o,l){"userName"===a.property&&(t.userGet(e.userId).then((e=>{if(200===e.code){const a=[],t=[];e.data.partTimeOrgans.forEach((e=>{a.push({name:e.organName})})),e.data.roles.forEach((e=>{t.push(e.roleName)}));const o={name:e.data.userName?e.data.userName:"-",cellPhone:e.data.userTel?e.data.userTel:"-",account:e.data.accountNo?e.data.accountNo:"-",hostOrganName:e.data.hostOrganName?e.data.hostOrganName:"-",departmentList:a||"-",role:t?t.join("、"):"-",jobTitle:e.data.userTitle?e.data.userTitle:"-",mailbox:e.data.userMail?e.data.userMail:"-",EnterpriseWechatID:e.data.qweiNo?e.data.qweiNo:"-",NailID:e.data.dingdingNo?e.data.dingdingNo:"-",remark:e.data.readme?e.data.readme:"-",FacePicturePath:e.data.userFaceUri?s+e.data.userFaceUri:null};G.componentsDocumentsDetails.visible.forEach(((e,a)=>{"Staff-Details"===e.name&&(G.componentsDocumentsDetails.visible[a]["basicInformation-data"]=o)}))}})),G.componentsDocumentsDetails.show=!0)}const te=(e,o,l,r)=>{G.JyElMessageBox.oneBtn=!1,G.JyElMessageBox.confirmText="t-zgj-select.confirm";const d=[];d.push(o.userId),G.componentsBatch.userIds=d,"t-zgj-Edit"===l.name&&(G.title="t-zgj-Edit",G.componentsAddForm.formData.partTimeOrgans=[],G.componentsAddForm.formData.partTimeOrganIds=[],G.componentsAddForm.formData.roleIds=[],G.componentsAddForm.formData.roles=[],G.tabSelects.rolesSelected=[],G.tabSelects.partTimeOrgansSelected=[],G.componentsAddForm.formData.userFaceUri="",t.userGet(o.userId).then((e=>{G.tabSelects.leaderUserSelected=[{id:e.data.leaderUserId,name:e.data.leaderUserName,type:"user"}],G.tabSelects.hostOrganSelected=[{id:e.data.hostOrganId,name:e.data.hostOrganName,type:"organ"}];for(const a in e.data)G.componentsAddForm.formData[a]=e.data[a],"partTimeOrgans"===a&&e.data[a].length>0&&(G.tabSelects.partTimeOrgansSelected=e.data[a].map((e=>({value:e.organId,label:e.organName,haveChildren:e.haveChildren,type:"organ"}))),G.tabSelects.partTimeOrgansSelected=Ae(G.tabSelects.partTimeOrgansSelected),G.componentsAddForm.formData.partTimeOrganIds=e.data[a].map((e=>e.organId))),"roles"===a&&e.data[a].length>0&&(G.tabSelects.rolesSelected=Ae(G.tabSelects.rolesSelected),G.tabSelects.rolesSelected=e.data[a].map((e=>({value:e.roleId,label:e.roleName,type:"role"}))),G.componentsAddForm.formData.roleIds=e.data[a].map((e=>e.roleId)))})),a.value=!0),"status"===l.name&&"启用"===o.flag&&(G.JyElMessageBox.header.data="t-zgj-seal.deactivated",G.JyElMessageBox.content.data="确认要停用该员工吗？",G.JyElMessageBox.show=!0,G.JyElMessageBox.type="停用"),"status"===l.name&&"停用"===o.flag&&(G.JyElMessageBox.header.data="t-zgj-Enable",G.JyElMessageBox.content.data="确认要启用该员工吗？",G.JyElMessageBox.show=!0,G.JyElMessageBox.type="启用"),"t-zgj-Delete"===l.name&&(G.JyElMessageBox.column=o,G.JyElMessageBox.header.data="t-zgj-Delete",G.JyElMessageBox.content.data="确认要删除该员工吗？",G.JyElMessageBox.show=!0,G.JyElMessageBox.type="删除"),"t-zgj-findpwd.resetPassword"===l.name&&(f.value="t-zgj-findpwd.resetPassword",h.value=!0),"t-zgj-F_SEAL_CONSOLE_FACE_SETTING"===l.name&&t.userGet(o.userId,!0).then((e=>{D.value=!0,G.userUpdateFaceUri=e.data.userFaceUri?s+e.data.userFaceUri:null,G.userUpdateFaceId=e.data.fileId}),(()=>{D.value=!0,G.userUpdateFaceUri=null,G.userUpdateFaceId=null}))},oe=()=>{G.showToastDialog.show=!1,setTimeout((()=>{G.showToastDialog.oneBtn=!1,G.showToastDialog.confirmText="t-zgj-select.confirm"}),1e3)},re=e=>{if("停用"===e&&t.userDisable(G.componentsBatch.userIds[0]).then((a=>{200===a.code&&(V.success(`${e}成功！`),G.JyElMessageBox.show=!1,O.value.reloadData(!0))})),"启用"===e&&t.userEnable(G.componentsBatch.userIds[0]).then((a=>{200===a.code&&(V.success(`${e}成功！`),G.JyElMessageBox.show=!1,O.value.reloadData(!0))})),"删除"===e){if("启用"===G.JyElMessageBox.column.flag)return G.JyElMessageBox.header.data="t-zgj-Delete",G.JyElMessageBox.content.data="请停用该员工后再进行删除",G.JyElMessageBox.oneBtn=!0,G.JyElMessageBox.type="提示",G.JyElMessageBox.confirmText="t-zgj-know",!1;t.userDelete(G.componentsBatch.userIds[0]).then((a=>{200===a.code&&(V.success(`${e}成功！`),G.JyElMessageBox.show=!1,O.value.reloadData())}))}if("批量停用"===e&&t.userBatchDisable(G.componentsBatch.userIds).then((a=>{200===a.code&&(V.success(`${e}成功！`),G.showToastDialog.show=!1,O.value.reloadData(!0))})),"批量启用"===e&&t.userBatchEnable(G.componentsBatch.userIds).then((a=>{200===a.code&&(V.success(`${e}成功！`),G.showToastDialog.show=!1,O.value.reloadData(!0))})),"批量删除"===e){const a=[];if(G.componentsBatch.selectionData.forEach((e=>{"启用"===e.flag&&a.push(e)})),a.length>0)return G.showToastDialog.content.data="请将以下员工停用后再进行删除",G.componentsBatch.selectionData=a,G.showToastDialog.confirmText="t-zgj-know",G.showToastDialog.oneBtn=!0,!1;t.userBatchDelete(G.componentsBatch.userIds).then((a=>{200===a.code&&(V.success(`${e}成功！`),G.showToastDialog.show=!1,O.value.reloadData())}))}};function Ie(){G.componentsDocumentsDetails.show=!1}const xe=e=>{r.value.validate((async e=>{e?(L.value=!0,G.componentsAddForm.formData.partTimeOrgans=[],G.tabSelects.partTimeOrgansSelected=Ae(G.tabSelects.partTimeOrgansSelected),G.tabSelects.rolesSelected=Ae(G.tabSelects.rolesSelected),G.componentsAddForm.formData.partTimeOrganIds.forEach((e=>{G.tabSelects.partTimeOrgansSelected.forEach((a=>{e===a.value&&G.componentsAddForm.formData.partTimeOrgans.push({organId:a.value,organName:a.label,haveChildren:a.haveChildren})}))})),G.componentsAddForm.formData.roles=[],G.componentsAddForm.formData.roleIds.forEach((e=>{G.tabSelects.rolesSelected.forEach((a=>{e===a.value&&G.componentsAddForm.formData.roles.push({roleId:a.value,roleName:a.label})}))})),G.componentsAddForm.formData.userId?Ue(G.componentsAddForm.formData):Be(G.componentsAddForm.formData)):L.value=!1}))},Ae=e=>{const a=new Map;for(const t of e)a.set(t.value,t);return e=[...a.values()]},Be=e=>{t.userAdd(G.componentsAddForm.formData).then((e=>{V.success("新增员工成功！"),O.value.reloadData(),r.value.resetFields(),a.value=!1,G.tabSelects={searchSelected:[],hostOrganSelected:[],rolesSelected:[],leaderUserSelected:[]},L.value=!1})).catch((()=>{L.value=!1}))},Ue=e=>{t.userEdit(e).then((e=>{200===e.code&&(V.success("修改员工成功！"),r.value.resetFields(),O.value.reloadData(!0),a.value=!1,G.tabSelects={searchSelected:[],hostOrganSelected:[],rolesSelected:[],leaderUserSelected:[],partTimeOrgansSelected:[]}),L.value=!1}))},Ee=()=>{a.value=!1},Oe=e=>{I.value=e.organId,O.value.reloadData()},je=(e,a)=>{"partTimeOrgan"===a&&(G.tabSelects.searchSelected=G.tabSelects.partTimeOrgansSelected.length>0?G.tabSelects.partTimeOrgansSelected.map((e=>({...e,id:e.value,name:e.label,type:"organ"}))):[],G.tabSelects.partTimeOrgansSelected=Ne(G.tabSelects.searchSelected,e)),"roles"===a&&(G.tabSelects.searchSelected=G.tabSelects.rolesSelected.length>0?G.tabSelects.rolesSelected.map((e=>({...e,id:e.value,name:e.label,type:"role"}))):[],G.tabSelects.rolesSelected=Ne(G.tabSelects.searchSelected,e))},Ne=(e,a)=>Array.isArray(e)&&0!==e.length?e.filter((e=>e.id!==a)):e;return C((()=>{O.value.reloadData()})),(e,t)=>{const l=v("el-button"),n=v("el-dropdown-item"),m=v("el-dropdown-menu"),g=v("el-dropdown"),b=v("el-tree"),w=v("el-input"),j=v("el-form-item"),N=v("el-option"),V=v("el-select"),C=v("el-col"),P=v("el-row"),se=v("el-image"),Ae=v("el-upload"),Be=v("el-form"),Ue=c;return S(),y("div",null,[F(u,{url:"/user/page",ref_key:"table",ref:O,hasTree:!0,needAutoRequest:!1,componentsSearchForm:B(G).componentsSearchForm,componentsTableHeader:B(G).componentsTable.header,componentsBatch:B(G).componentsBatch,tableClick:"userName",statusColoum:"flag",openValue:"启用",onCellClick:ae,onCustomClick:te,onClickBatchButton:ee,queryParams:{organId:I.value}},{title:T((()=>[_("div",de,[_("div",null,x(e.$t("t-zgj-F_SYSTEM_PERSON_MANAGE")),1),_("div",ne,[_("div",ce,[F(l,{type:"primary",onClick:Y},{default:T((()=>[A("+ "+x(e.$t("t-zgj-add")),1)])),_:1})]),_("div",me,[F(g,{"popper-class":"more-operation-dropdown"},{dropdown:T((()=>[F(m,null,{default:T((()=>[F(n,null,{default:T((()=>[A(x(e.$t("t-zgj-F_SYSTEM_PERSON_MANAGE_IMPORT")),1)])),_:1}),F(n,null,{default:T((()=>[A(x(e.$t("t-zgj-F_SYSTEM_FACEINFO_MANAGE_IMPORT")),1)])),_:1})])),_:1})])),default:T((()=>[F(l,null,{default:T((()=>[ie,_("span",null,x(e.$t("t-zgj-table.more.Operation")),1)])),_:1})])),_:1})])])])])),tree:T((()=>[_("div",ue,[F(b,M({data:B(G).componentsTree.data,props:B(G).componentsTree.defaultProps},B(G).componentsTree.defaultAttribute,{lazy:"",load:R,onCurrentChange:Oe}),null,16,["data","props"])])])),_:1},8,["componentsSearchForm","componentsTableHeader","componentsBatch","queryParams"]),F(Ue,{show:a.value,title:e.$t(B(G).title),centerBtn:!0,confirmLoading:L.value,confirmText:e.$t("t-zgj-operation.submit"),concelText:e.$t("t-zgj-operation.cancel"),width:950,"destroy-on-close":"",height:"calc(100vh - 500px)",onClose:Ee,onConfirm:xe,class:"staff-add"},{default:T((()=>[F(Be,{model:B(G).componentsAddForm.formData,rules:B(G).componentsAddForm.formRules,ref_key:"formStaffRef",ref:r,"label-width":"100px"},{default:T((()=>[F(j,{label:"姓名",prop:"userName"},{default:T((()=>[F(w,{modelValue:B(G).componentsAddForm.formData.userName,"onUpdate:modelValue":t[0]||(t[0]=e=>B(G).componentsAddForm.formData.userName=e),placeholder:"请输入姓名",clearable:"",maxlength:"64"},null,8,["modelValue"])])),_:1}),F(j,{label:"帐号",prop:"accountNo"},{default:T((()=>[F(w,{modelValue:B(G).componentsAddForm.formData.accountNo,"onUpdate:modelValue":t[1]||(t[1]=e=>B(G).componentsAddForm.formData.accountNo=e),placeholder:"请输入帐号",clearable:"",maxlength:"64"},null,8,["modelValue"])])),_:1}),F(j,{label:"手机号",prop:"userTel"},{default:T((()=>[F(w,{modelValue:B(G).componentsAddForm.formData.userTel,"onUpdate:modelValue":t[2]||(t[2]=e=>B(G).componentsAddForm.formData.userTel=e),maxlength:"11",placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])])),_:1}),F(j,{label:"所属部门",prop:"hostOrganName"},{default:T((()=>[_("div",pe,[F(w,{class:"ap-box-contBox-input width-100",readonly:"",modelValue:B(G).componentsAddForm.formData.hostOrganName,"onUpdate:modelValue":t[3]||(t[3]=e=>B(G).componentsAddForm.formData.hostOrganName=e),placeholder:"请选择所属部门",onClick:t[4]||(t[4]=e=>H("hostOrgan",!1))},null,8,["modelValue"]),_("div",he,[_("img",{onClick:t[5]||(t[5]=e=>H("hostOrgan",!1)),class:"ap-box-contBox-icon-img",src:i,alt:""})])])])),_:1}),F(j,{label:"兼职部门",prop:"partTimeOrganIds"},{default:T((()=>[_("div",ge,[F(V,{modelValue:B(G).componentsAddForm.formData.partTimeOrganIds,"onUpdate:modelValue":t[6]||(t[6]=e=>B(G).componentsAddForm.formData.partTimeOrganIds=e),multiple:"",placeholder:"请选择兼职部门",style:{width:"100%"},"popper-class":"hidePoper","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":5,onClick:t[7]||(t[7]=e=>H("partTimeOrgan",!0)),onRemoveTag:t[8]||(t[8]=e=>je(e,"partTimeOrgan"))},{default:T((()=>[(S(!0),y(k,null,z(B(G).tabSelects.partTimeOrgansSelected,(e=>(S(),U(N,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),_("div",{class:"ap-box-contBox-icon",onClick:t[9]||(t[9]=e=>H("partTimeOrgan",!0))},fe)])])),_:1}),F(j,{label:"职位",prop:"userTitle"},{default:T((()=>[F(w,{modelValue:B(G).componentsAddForm.formData.userTitle,"onUpdate:modelValue":t[10]||(t[10]=e=>B(G).componentsAddForm.formData.userTitle=e),placeholder:"请输入职位",clearable:"",maxlength:"128"},null,8,["modelValue"])])),_:1}),F(j,{label:"邮箱",prop:"userMail"},{default:T((()=>[F(w,{modelValue:B(G).componentsAddForm.formData.userMail,"onUpdate:modelValue":t[11]||(t[11]=e=>B(G).componentsAddForm.formData.userMail=e),placeholder:"请输入邮箱",clearable:"",maxlength:"128"},null,8,["modelValue"])])),_:1}),F(j,{label:"工号",prop:"userNo"},{default:T((()=>[F(w,{modelValue:B(G).componentsAddForm.formData.userNo,"onUpdate:modelValue":t[12]||(t[12]=e=>B(G).componentsAddForm.formData.userNo=e),placeholder:"请输入工号",clearable:"",maxlength:"64"},null,8,["modelValue"])])),_:1}),F(j,{label:"主管",prop:"leaderUserName"},{default:T((()=>[_("div",be,[F(w,{class:"ap-box-contBox-input width-100",readonly:"",modelValue:B(G).componentsAddForm.formData.leaderUserName,"onUpdate:modelValue":t[13]||(t[13]=e=>B(G).componentsAddForm.formData.leaderUserName=e),placeholder:"请选择主管",onClick:t[14]||(t[14]=e=>H("leaderUser",!1))},null,8,["modelValue"]),F(w,{class:"ap-box-contBox-input width-100",readonly:"",type:"hidden",modelValue:B(G).componentsAddForm.formData.leaderUserId,"onUpdate:modelValue":t[15]||(t[15]=e=>B(G).componentsAddForm.formData.leaderUserId=e),placeholder:"请选择"},null,8,["modelValue"]),_("div",De,[_("img",{onClick:t[16]||(t[16]=e=>H("leaderUser",!1)),class:"ap-box-contBox-icon-img",src:i,alt:""})])])])),_:1}),F(j,{label:"角色",prop:"roleIds"},{default:T((()=>[_("div",we,[F(V,{modelValue:B(G).componentsAddForm.formData.roleIds,"onUpdate:modelValue":t[17]||(t[17]=e=>B(G).componentsAddForm.formData.roleIds=e),multiple:"",placeholder:"请选择角色",style:{width:"100%"},"popper-class":"hidePoper",onClick:t[18]||(t[18]=e=>H("roles",!0)),onRemoveTag:t[19]||(t[19]=e=>je(e,"roles"))},{default:T((()=>[(S(!0),y(k,null,z(B(G).tabSelects.rolesSelected,(e=>(S(),U(N,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),_("div",{class:"ap-box-contBox-icon",onClick:t[20]||(t[20]=e=>H("roles",!0))},ve)])])),_:1}),F(P,{gutter:20},{default:T((()=>[F(C,{span:12},{default:T((()=>[F(j,{label:"企业微信ID",prop:"qweiNo"},{default:T((()=>[F(w,{modelValue:B(G).componentsAddForm.formData.qweiNo,"onUpdate:modelValue":t[21]||(t[21]=e=>B(G).componentsAddForm.formData.qweiNo=e),placeholder:"请输入企业微信ID",clearable:"",maxlength:"256"},null,8,["modelValue"])])),_:1})])),_:1}),F(C,{span:12},{default:T((()=>[F(j,{label:"钉钉ID",prop:"dingdingNo"},{default:T((()=>[F(w,{modelValue:B(G).componentsAddForm.formData.dingdingNo,"onUpdate:modelValue":t[22]||(t[22]=e=>B(G).componentsAddForm.formData.dingdingNo=e),placeholder:"请输入钉钉ID",clearable:"",maxlength:"256"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),F(P,{gutter:20},{default:T((()=>[F(C,{span:12},{default:T((()=>[F(j,{label:"人脸照片",prop:"userFaceId"},{default:T((()=>[F(Ae,{ref:"uploadRef",action:`${B(s)}/user/uploadUserFace`,"show-file-list":!1,"list-type":"picture-card","on-success":X,"before-upload":Z},{tip:T((()=>[Fe,Te])),default:T((()=>[F(w,{type:"hidden",modelValue:B(G).componentsAddForm.formData.userFaceId,"onUpdate:modelValue":t[23]||(t[23]=e=>B(G).componentsAddForm.formData.userFaceId=e)},null,8,["modelValue"]),B(G).componentsAddForm.formData.userFaceUri?(S(),U(se,{key:0,src:B(s)+B(G).componentsAddForm.formData.userFaceUri,style:{padding:"6px"}},{error:T((()=>[])),_:1},8,["src"])):(S(),y("svg",Se,ye))])),_:1},8,["action"])])),_:1})])),_:1}),F(C,{span:12},{default:T((()=>[F(j,{label:"备注",prop:"readme"},{default:T((()=>[F(w,{type:"textarea",rows:7,modelValue:B(G).componentsAddForm.formData.readme,"onUpdate:modelValue":t[24]||(t[24]=e=>B(G).componentsAddForm.formData.readme=e),placehoder:"请输入备注",maxlength:"512"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["show","title","confirmLoading","confirmText","concelText"]),o.value?(S(),U(B(d),{key:0,show:o.value,multiple:B(G).multiple,"onUpdate:show":t[25]||(t[25]=e=>o.value=e),tabsShow:B(G).tabsShow,"onUpdate:searchSelected":Q,searchSelected:B(G).tabSelects.searchSelected,haveIncluded:!1},null,8,["show","multiple","tabsShow","searchSelected"])):E("",!0),_("div",_e,[F(p,{show:B(G).componentsDocumentsDetails.show,visible:B(G).componentsDocumentsDetails.visible,onClickClose:Ie},null,8,["show","visible"])]),F(B(J),{"onUpdate:modelValue":t[26]||(t[26]=e=>B(G).showToastDialog.show=!1),show:B(G).showToastDialog.show,selectionData:B(G).componentsBatch.selectionData,showToastDialogContent:B(G).showToastDialog,label:"userName",oneBtn:B(G).showToastDialog.oneBtn,confirmText:B(G).showToastDialog.confirmText,onCancel:oe,onSureAction:t[27]||(t[27]=e=>re(B(G).showToastDialog.type))},null,8,["show","selectionData","showToastDialogContent","oneBtn","confirmText"]),F(B($),{modelValue:B(G).JyElMessageBox.show,"onUpdate:modelValue":[t[28]||(t[28]=e=>B(G).JyElMessageBox.show=e),B(G).JyElMessageBox.show],JyElMessageBox:B(G).JyElMessageBox,confirmText:B(G).JyElMessageBox.confirmText,oneBtn:B(G).JyElMessageBox.oneBtn,onSubmitElMessageBox:t[29]||(t[29]=e=>re(B(G).JyElMessageBox.type))},null,8,["modelValue","JyElMessageBox","confirmText","oneBtn","onUpdate:modelValue"]),F(K,{show:h.value,title:f.value,userIds:B(G).componentsBatch.userIds,onOnConfirm:q,onOnCancel:W},null,8,["show","title","userIds"]),F(le,{show:D.value,userId:B(G).componentsBatch.userIds[0],userFaceUri:B(G).userUpdateFaceUri,userUpdateFaceId:B(G).userUpdateFaceId,onOnConfirm:q,onOnCancel:W},null,8,["show","userId","userFaceUri","userUpdateFaceId"])])}}},[["__scopeId","data-v-a8bd7420"]]);export{Ie as default};
